pipeline{
    
    agent any
    
    tools{
maven 'maven3.8.4'
}

triggers {
  pollSCM '* * * * *'
   //cron '* * * * *'
}
options {
  timestamps()
  //Discardoldbuilds
   buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
}


    
    stages{
        
        //Get the code from GitHub
        stage('CheckoutCode'){
        steps{
            git branch: 'development', credentialsId: '1bbb78b7-6e9e-4b1d-bd1d-83cfea50de77', url: 'https://github.com/tejasaikiranp/maven-web-application.git'
    }
    }
    
    //Do the build
    stage('Build'){
        steps{
            sh "mvn clean package"
        }
        }
        //Execute SonarQube Report
stage('SonarQube Report'){
steps{
sh "mvn clean sonar:sonar"
}
}

//Upload Artifact Into Nexus Server
stage('UploadArtifactIntoNexusServer'){
steps{
sh "mvn clean deploy"
}
}

//Deploy Application Into Tomcat Server
stage('DeployApplicationIntoTomcatServer'){
steps{
sshagent(['07a5c535-2567-4910-9ec9-54a14c3b36b4']){
            sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.235.81.135:/opt/apache-tomcat-10.0.21/webapps"
            
        }
}
}
        
        
        
    }//Stage Closing
}
